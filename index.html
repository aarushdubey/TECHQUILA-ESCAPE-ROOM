<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Tech Club - The Hack</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        /* The 'overflow: hidden;' property has been removed from the body tag below */
        body { font-family: 'Inter', sans-serif; }
        .tech-mono { font-family: 'Share Tech Mono', monospace; }
        .matrix-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background-color: #0d1117; }
        .panel-disabled { opacity: 0.4; pointer-events: none; }
        .code-display { width: 60px; height: 70px; background: #000; border: 2px solid #374151; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: #4b5563; }
        .code-display.unlocked { border-color: #f59e0b; color: #f59e0b; box-shadow: 0 0 15px #f59e0b; }
        .lever { width: 12px; height: 50px; background: #9ca3af; border-radius: 6px; cursor: pointer; transition: margin .2s; margin-top: 0px; }
        .lever-container { width: 30px; height: 100px; background: #4b5563; border-radius: 15px; display: flex; justify-content: center; padding: 5px; }
        .switch { width: 50px; height: 25px; background: #ef4444; border-radius: 12.5px; position: relative; cursor: pointer; border: 2px solid #1f2937; }
        .switch::before { content: ''; position: absolute; width: 21px; height: 21px; background: #f0f0f0; border-radius: 50%; top: 0px; left: 2px; transition: .3s; }
        .switch.on { background: #22c55e; }
        .switch.on::before { transform: translateX(25px); }

        /* --- ADDED FOR VIEW SWITCHER --- */
        #view-switcher-label { display: flex; align-items: center; gap: 0.5rem; cursor: pointer; }
        #view-toggle { appearance: none; width: 50px; height: 25px; background: #06b6d4; border-radius: 12.5px; position: relative; outline: none; transition: .3s; }
        #view-toggle::before { content: ''; position: absolute; width: 21px; height: 21px; background: white; border-radius: 50%; top: 2px; left: 2px; transition: .3s; }
        #view-toggle:checked { background: #4f46e5; }
        #view-toggle:checked::before { transform: translateX(25px); }
        body.mobile-view #view-wrapper { max-width: 414px !important; margin: 2rem auto; }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <canvas id="matrix-bg" class="matrix-bg"></canvas>

    <div style="position: fixed; top: 1rem; right: 1rem; z-index: 1000; background-color: rgba(17, 24, 39, 0.8); padding: 0.5rem 1rem; border-radius: 1rem; border: 1px solid #374151;">
        <label id="view-switcher-label" class="tech-mono text-sm">
            <span class="text-cyan-400">Mobile</span>
            <input type="checkbox" id="view-toggle">
            <span class="text-indigo-400">Desktop</span>
        </label>
    </div>

    <div id="view-wrapper">
        <div class="min-h-screen flex items-center justify-center p-4 relative z-10">
            <div class="w-full max-w-6xl bg-gray-800/80 backdrop-blur-sm border border-green-500/30 rounded-lg shadow-2xl shadow-green-500/10 p-6">
                <h1 class="text-2xl md:text-3xl font-bold text-green-400 mb-4 text-center tech-mono">Stage 1: System Reboot Sequence</h1>
                
                <div class="flex flex-col md:flex-row items-center justify-between bg-gray-900/50 p-4 rounded-md border border-gray-700 mb-6">
                     <h2 class="text-xl tech-mono text-yellow-400 mb-2 md:mb-0">ACCESS CODE</h2>
                     <div class="flex space-x-4">
                         <div id="code-1" class="code-display">?</div>
                         <div id="code-2" class="code-display">?</div>
                         <div id="code-3" class="code-display">?</div>
                         <div id="code-4" class="code-display">?</div>
                     </div>
                     <div class="flex items-center space-x-3 mt-4 md:mt-0">
                          <span class="font-bold">MAIN POWER</span>
                          <div id="main-power" class="switch"></div>
                     </div>
                </div>
    
                <div id="main-panels" class="grid grid-cols-1 md:grid-cols-3 gap-6 panel-disabled">
                    <div class="bg-gray-900/50 p-4 rounded-md border border-gray-700 space-y-4">
                        <h3 class="text-lg tech-mono text-cyan-400 text-center">Core Systems Check</h3>
                        <button data-task="1" class="w-full bg-blue-600 hover:bg-blue-700 p-2 rounded task-btn">1. Scan Network Routes</button>
                        <button data-task="2" class="w-full bg-blue-600 hover:bg-blue-700 p-2 rounded task-btn">2. Verify Memory Integrity</button>
                        <button data-task="3" class="w-full bg-blue-600 hover:bg-blue-700 p-2 rounded task-btn">3. Initialize I/O Ports</button>
                        <button data-task="4" class="w-full bg-blue-600 hover:bg-blue-700 p-2 rounded task-btn">4. Check Core Processor</button>
                        <p class="text-xs text-center text-gray-500">Clue appears in the Terminal.</p>
                    </div>
    
                    <div class="bg-gray-900/50 p-4 rounded-md border border-gray-700 space-y-4">
                        <h3 class="text-lg tech-mono text-cyan-400 text-center">HINTS BELOW IN TERMINAL</h3>
                        <textarea id="terminal" class="w-full h-40 tech-mono bg-black text-green-500 text-sm p-2 rounded resize-none" readonly>// POWER OFF //</textarea>
                        <div class="flex justify-around items-center">
                            <div class="text-center">
                                <div class="lever-container"><div data-lever="1" class="lever"></div></div> L1
                            </div>
                            <div class="text-center">
                                <div class="lever-container"><div data-lever="2" class="lever"></div></div> L2
                            </div>
                            <div class="text-center">
                                <div class="lever-container"><div data-lever="3" class="lever"></div></div> L3
                            </div>
                        </div>
                    </div>
    
                    <div class="bg-gray-900/50 p-4 rounded-md border border-gray-700 space-y-4">
                         <h3 class="text-lg tech-mono text-cyan-400 text-center">Subsystems Control</h3>
                         <div class="flex items-center justify-between p-2 bg-gray-700 rounded">
                            <span>Coolant Pump</span>
                            <div id="coolant-switch" class="switch"></div>
                         </div>
                         <div class="text-center">
                             <label for="temp-slider" class="block">Core Temperature (<span id="slider-val">20</span>Â°C)</label>
                             <input type="range" id="temp-slider" min="20" max="100" value="20" class="w-full">
                         </div>
                         <div class="grid grid-cols-3 gap-2">
                            <button class="bg-gray-600 p-2 rounded router-btn" data-router="1">Router 1</button>
                            <button class="bg-gray-600 p-2 rounded router-btn" data-router="2">Router 2</button>
                            <button class="bg-gray-600 p-2 rounded router-btn" data-router="3">Router 3</button>
                         </div>
                         
                         <div id="math-puzzle-container" class="hidden space-y-2 pt-4">
                             <p class="text-center text-yellow-400 tech-mono">Final Security Verification</p>
                             <div class="text-xs text-center p-2 bg-black rounded border border-gray-600">
                                <p>To calibrate power flow, calculate the final value:</p>
                                <p>Start with the <strong>Core Temperature</strong> (Code 3) and subtract the <strong>Authentication value</strong> (Code 2). Then, add the <strong>amplified Network value</strong> (Code 1 multiplied by 3). Finally, subtract the <strong>Router checksum</strong> (Code 4).</p>
                             </div>
                             <input id="math-answer" type="text" class="w-full bg-black text-green-500 tech-mono p-2 rounded border border-gray-600 text-center" placeholder="Enter Calibration Value">
                             <button id="submit-math-btn" class="w-full bg-green-600 hover:bg-green-700 p-2 rounded">Verify</button>
                         </div>
                         
                         <button id="next-stage-btn" class="w-full bg-yellow-600 text-black font-bold p-3 rounded opacity-0 pointer-events-none transition-opacity">PROCEED TO STAGE 2</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- ADDED: View Switcher Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const viewToggle = document.getElementById('view-toggle');
            const setViewMode = (mode) => {
                if (mode === 'mobile') {
                    document.body.classList.add('mobile-view');
                    viewToggle.checked = false;
                } else {
                    document.body.classList.remove('mobile-view');
                    viewToggle.checked = true;
                }
            };
            viewToggle.addEventListener('change', () => {
                const newMode = viewToggle.checked ? 'desktop' : 'mobile';
                localStorage.setItem('viewMode', newMode);
                setViewMode(newMode);
            });
            const savedMode = localStorage.getItem('viewMode') || 'desktop';
            setViewMode(savedMode);
        });
        
        // --- State Management ---
        const state = {
            power: false,
            code1: null,
            code2: null,
            code3: null,
            code4: null,
            levers: { 1: 2, 2: 2, 3: 2 }, 
            coolant: false,
        };

        // --- Elements ---
        const mainPower = document.getElementById('main-power');
        const mainPanels = document.getElementById('main-panels');
        const terminal = document.getElementById('terminal');
        const nextStageBtn = document.getElementById('next-stage-btn');

        // --- Event Listeners ---
        mainPower.addEventListener('click', togglePower);
        nextStageBtn.addEventListener('click', () => window.location.href = 'stage2.html');
        
        // --- Power Control ---
        function togglePower() {
            state.power = !state.power;
            mainPower.classList.toggle('on', state.power);
            mainPanels.classList.toggle('panel-disabled', !state.power);
            terminal.value = state.power ? 'System Online. Awaiting commands... Check all core systems one by one' : '// POWER OFF //';
        }

        // --- Task 1: Core Systems Check ---
        document.querySelectorAll('.task-btn').forEach(btn => {
            btn.addEventListener('click', e => {
                if (!state.power) return;
                const taskNum = e.target.dataset.task;
                switch(taskNum) {
                    case '1': terminal.value += '\n> Network scan... 14 active nodes found.'; break;
                    case '2': terminal.value += '\n> Memory integrity... All 32 GB verified.'; break;
                    case '3': terminal.value += '\n> I/O ports... the correct core temperatures ranges from 80 to 100'; break;
                    case '4': terminal.value += '\n> Core processor... Clock speed stable at 4 GHz. L1,L2,L3 are up down up '; break;
                }
                if (terminal.value.includes('14') && terminal.value.includes('32') && terminal.value.includes('8') && terminal.value.includes('4') && !state.code1) {
                    state.code1 = '14';
                    updateCodeDisplay(1, '14');
                    terminal.value += '\n[OK] Core checks complete. CODE FRAGMENT #1 UNLOCKED.';
                    terminal.value += '\n[HINT] Auth protocol requires lever sequence: UP, DOWN, UP.';
                }
            });
        });

        // --- Task 2: Authentication Levers ---
        const leverElements = {
            1: document.querySelector('[data-lever="1"]'),
            2: document.querySelector('[data-lever="2"]'),
            3: document.querySelector('[data-lever="3"]')
        };

        leverElements[2].addEventListener('click', () => {
            if (state.code2 || !state.power) return;
            state.levers = { 1: 2, 2: 0, 3: 2 }; 
            leverElements[1].style.marginTop = '0px';
            leverElements[2].style.marginTop = '70px';
            leverElements[3].style.marginTop = '0px';
            state.code2 = '28'; 
            updateCodeDisplay(2, '28');
            terminal.value += '\n[OK] Authentication successful. CODE FRAGMENT #2 UNLOCKED.';
        });

        // --- Task 3: Subsystems - Coolant and Temp ---
        document.getElementById('coolant-switch').addEventListener('click', e => {
            state.coolant = !state.coolant;
            e.target.classList.toggle('on', state.coolant);
            if(state.coolant) terminal.value += '\n> Coolant pump ACTIVATED. Core temp stabilization available.';
        });

        document.getElementById('temp-slider').addEventListener('input', e => {
            const temp = e.target.value;
            document.getElementById('slider-val').textContent = temp;
            if (state.coolant && temp === '88' && !state.code3) {
                 state.code3 = '88';
                 updateCodeDisplay(3, '88');
                 terminal.value += `\n[OK] Core temperature stabilized at ${temp}Â°C. CODE FRAGMENT #3 UNLOCKED.`;
                 terminal.value += '\n[HINT] Network relay requires reboot of routers #1 and #3.';
            }
        });

        // --- Task 4: Router Reboot ---
        const correctRouters = new Set();
        document.querySelectorAll('.router-btn').forEach(btn => {
            btn.addEventListener('click', e => {
                const routerNum = e.target.dataset.router;
                if (routerNum === '1' || routerNum === '3') {
                    correctRouters.add(routerNum);
                    e.target.style.backgroundColor = '#22c55e';
                } else {
                    e.target.style.backgroundColor = '#ef4444';
                }
                if (correctRouters.size === 2 && !state.code4) {
                    state.code4 = '42';
                    updateCodeDisplay(4, '42');
                    terminal.value += '\n[OK] Network relay established. CODE FRAGMENT #4 UNLOCKED.';
                    checkAllCodesUnlocked();
                }
            });
        });

        function updateCodeDisplay(part, value) {
            const el = document.getElementById(`code-${part}`);
            el.textContent = value;
            el.classList.add('unlocked');
        }
        
        function checkAllCodesUnlocked() {
            if (state.code1 && state.code2 && state.code3 && state.code4) {
                terminal.value += '\n\n*** ALL SYSTEMS GO. AWAITING FINAL VERIFICATION. ***';
                document.getElementById('math-puzzle-container').classList.remove('hidden');
            }
        }
        
        // --- Task 5: Final Math Puzzle ---
        document.getElementById('submit-math-btn').addEventListener('click', () => {
            const userAnswer = document.getElementById('math-answer').value;
            // The formula is: (Code 3 - Code 2) + (Code 1 * 3) - Code 4
            // (88 - 28) + (14 * 3) - 42  =  60 + 42 - 42  =  60
            const correctAnswer = (parseInt(state.code3) - parseInt(state.code2)) + (parseInt(state.code1) * 3) - parseInt(state.code4);

            if (parseInt(userAnswer) === correctAnswer) {
                terminal.value += '\n[OK] Verification complete. ACCESS GRANTED.';
                document.getElementById('math-puzzle-container').classList.add('hidden');
                nextStageBtn.classList.remove('opacity-0', 'pointer-events-none');
            } else {
                terminal.value += '\n[ERROR] Incorrect calibration value. Try again.';
                document.getElementById('math-answer').value = ''; 
            }
        });

        // --- Matrix Background ---
        const canvas = document.getElementById('matrix-bg');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const chars = "01";
        const charArray = chars.split('');
        const fontSize = 16;
        const columns = canvas.width / fontSize;
        const drops = Array.from({ length: columns }).fill(1);

        function drawMatrix() {
            ctx.fillStyle = 'rgba(13, 17, 23, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#00FF00';
            ctx.font = fontSize + 'px arial';
            for(let i = 0; i < drops.length; i++) {
                const text = charArray[Math.floor(Math.random() * charArray.length)];
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if(drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            }
        }
        setInterval(drawMatrix, 40);
        window.addEventListener('resize', () => { location.reload(); });
    </script>
</body>
</html>
